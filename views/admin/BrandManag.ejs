<link rel="stylesheet" href="../css/admin/dashboard-side.css">
<!-- Link to the new CSS file -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="/css/admin/categoryManag.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<body>
    <div class="container">
        <%- include("../partials/adminSideBar") %>

            <div class="main-content">
                <section class="content-main">
                    <div class="content-header">
                        <div>
                            <h2 class="content-title card-title">Brand Management</h2>
                        </div>

                        <!-- Search -->
                        <div class="search-container">
                            <form action="/admin/brands" method="GET" style="display: flex; gap: 10px;">
                                <input type="text" placeholder="Search brands..." class="search-input" name="search"
                                    value="<%= typeof search !== 'undefined' ? search : '' %>">
                                <button type="submit" class="btn-search">Search</button>
                                <% if(typeof search !=='undefined' && search) { %>
                                    <a href="/admin/brands" class="btn-search"
                                        style="background-color: #6c757d; text-decoration: none;">Clear</a>
                                    <% } %>
                            </form>
                        </div>
                    </div>
                    <!-- Add Brand Form -->
                    <div class="card mb-4" style="padding: 20px;">
                        <h4>Add New Brand</h4>
                        <form id="addBrandForm">
                            <div class="form-group">
                                <input type="text" name="name" placeholder="Brand Name" class="form-control" required />
                            </div>
                            <div class="form-group">
                                <textarea name="description" placeholder="Description" class="form-control"></textarea>
                            </div>
                            <button type="submit" class="btn-search">Add Brand</button>
                        </form>
                    </div>
                    <!-- Table -->
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (data && data.length> 0) { %>
                                    <% data.forEach(brand=> { %>
                                        <tr>
                                            <td><b>
                                                    <%= brand.name %>
                                                </b></td>
                                            <td>
                                                <%= brand.description || '' %>
                                            </td>
                                            <td>
                                                <% if(!brand.isBlocked) { %>
                                                    <span class="badge-listed">Active</span>
                                                    <% } else { %>
                                                        <span class="badge-unlisted">Blocked</span>
                                                        <% } %>
                                            </td>
                                            <td>
                                                <!-- Edit Button -->
                                                <button class="action-btn btn-edit"
                                                    onclick="openEditModal('<%= brand._id %>', '<%= brand.name %>', '<%= brand.description %>')">
                                                    Edit
                                                </button>

                                                <!-- Soft Delete Button -->
                                                <button
                                                    class="action-btn <%= !brand.isBlocked ? 'btn-unlist' : 'btn-list' %>"
                                                    onclick="toggleStatus('<%= brand._id %>')">
                                                    <%= !brand.isBlocked ? 'Block' : 'Unblock' %>
                                                </button>
                                            </td>
                                        </tr>
                                        <% }) %>
                                            <% } else { %>
                                                <tr>
                                                    <td colspan="4" class="text-center">No brands found</td>
                                                </tr>
                                                <% } %>
                            </tbody>
                        </table>
                    </div>
                    <!-- Pagination -->
                    <div class="pagination">
                        <% if (currentPage> 1) { %>
                            <a
                                href="?page=<%= currentPage - 1 %>&search=<%= typeof search !== 'undefined' ? search : '' %>">Previous</a>
                            <% } %>
                                <% for(let i=1; i <=totalPages; i++) { %>
                                    <a href="?page=<%= i %>&search=<%= typeof search !== 'undefined' ? search : '' %>"
                                        class="<%= i === currentPage ? 'active' : '' %>">
                                        <%= i %>
                                    </a>
                                    <% } %>
                                        <% if (currentPage < totalPages) { %>
                                            <a
                                                href="?page=<%= currentPage + 1 %>&search=<%= typeof search !== 'undefined' ? search : '' %>">Next</a>
                                            <% } %>
                    </div>
            </div>
            </section>
    </div> <!-- End .main-content -->
    </div> <!-- End .container -->

    <!-- Edit Modal -->
    <div id="editBrandModal" class="modal">
        <div class="modal-content">
            <span onclick="closeEditModal()" style="float:right; cursor:pointer; font-size: 20px;">&times;</span>
            <h3>Edit Brand</h3>
            <form id="editBrandForm">
                <input type="hidden" id="edit-id">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="edit-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="edit-description" class="form-control"></textarea>
                </div>
                <button type="submit" class="btn-search">Update</button>
            </form>
        </div>
    </div>

    <!-- Link the new JS file -->
    <script src="/js/admin/BrandManag.js"></script>